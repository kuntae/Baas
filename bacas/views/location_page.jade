extends menu_layout

block content

    script(type='text/javascript', src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js")
    script(type='text/javascript', src="http://maps.google.com/maps/api/js?sensor=false")
    script(type='text/javascript')
        $(document).ready(function() {

            function addRow(tableid, lat, lng, address) {
                var table = document.getElementById(tableid);
                var rowlen = table.rows.length;
                var row = table.insertRow(rowlen);
                row.insertCell(0).innerHTML = lat;
                row.insertCell(1).innerHTML = lng;
                row.insertCell(2).innerHTML = address;
            }

            var lat = new Array(#{lat});
            var lng = new Array(#{lng});
            var address = new Array(#{address});

            for(var i = 0; i < lat.length; i++)
                addRow('table', lat[i], lng[i], address[i]);

            var latlng = new google.maps.LatLng(37.5640, 126.9751);
            var myOptions = {
                    zoom : 12,
                    center : latlng,
                    mapTypeId : google.maps.MapTypeId.ROADMAP
            }
            var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
            var marker = new google.maps.Marker({
                    position : latlng,
                    map : map
            });

            var geocoder = new google.maps.Geocoder();

            google.maps.event.addListener(map, 'click', function(event) {
                   var location = event.latLng;
                   geocoder.geocode({
                           'latLng' : location
                   },
                   function(results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            var lat = document.getElementById('lat');
                            var lng = document.getElementById('lng');
                            var address = document.getElementById('address');

                            address.value = results[0].formatted_address;
                            lat.value = results[0].geometry.location.lat();
                            lng.value = results[0].geometry.location.lng();
                        }
                        else {
                            alert("Geocoder failed due to :" + status);
                        }
            });
            if (!marker) {
                   marker = new google.maps.Marker({
                       position : location,
                       map : map
                       });
            }
            else {
                   marker.setMap(null);
                   marker = new google.maps.Marker({
                       position : location,
                       map : map
                   });
            }
            map.setCenter(location);
            });
        });
    form(name="form", method="post", action="/web/addpoi")
        br
        br

        table(border="1")
            tr
                td(colspan="2")
                    div(id="map_canvas", style="width: 460px; height: 380px;")
            tr
                th(width="100") 위도
                td
                    input(id="lat", name="lat", value="", size="53")
            tr
                th 경도
                td
                    input(id="lng", name="lng", value="", size="53")
            tr
                th 주소
                td
                    input(id="address", name="address", value="", size="53")

        br

        input(type="submit", name="add", value="추가", style="width:50px; height:50px")

        form(name="form", method="post", action="/web/removepoi")
            input(type="submit", name="remove", value="삭제", style="width:50px; height:50px")
        br
        table(id ="table", width="600", border="1")
            tr
                th(align="center") 위도
                th(align="center") 경도
                th(align="center") 주소